<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>G√°bor szak√°csk√∂nyve 2026</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; padding: 20px; }
    .container { max-width: 1200px; margin: 0 auto; }
    header { background: #1e3c72; color: white; padding: 30px; border-radius: 15px; text-align: center; margin-bottom: 20px; }
    
    .controls { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .search-box { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 15px; }
    
    .filter-grid { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
    .filter-item { 
      background: #e9ecef; padding: 6px 14px; border-radius: 20px; cursor: pointer; 
      font-size: 0.85em; transition: 0.2s; border: 1px solid #dee2e6; user-select: none;
    }
    .filter-item.active { background: #2a5298; color: white; border-color: #2a5298; }
    .filter-item input { display: none; }

    .recipes { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
    .recipe-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
    .recipe-img { width: 100%; height: 180px; background: #eee; display: flex; align-items: center; justify-content: center; font-size: 3em; }
    .recipe-body { padding: 15px; flex-grow: 1; }
    .recipe-title { font-size: 1.2em; font-weight: bold; margin-bottom: 8px; color: #1e3c72; }
    .recipe-tags { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 10px; }
    .recipe-tag { background: #f0f7ff; color: #0056b3; font-size: 0.7em; padding: 2px 6px; border-radius: 4px; }
    
    .recipe-link { display: block; background: #2a5298; color: white; text-decoration: none; padding: 8px; border-radius: 6px; text-align: center; font-weight: bold; margin-top: 10px; }
    
    #loader { text-align: center; padding: 20px; font-weight: bold; }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>üç≥ G√°bor szak√°csk√∂nyve 2026</h1>
    <p id="recipeCount">Receptek bet√∂lt√©se...</p>
  </header>

  <div class="controls">
    <input type="text" id="searchInput" class="search-box" placeholder="Keres√©s n√©v vagy hozz√°val√≥ alapj√°n...">
    <div id="filterGrid" class="filter-grid"></div>
  </div>

  <div id="recipesContainer" class="recipes"></div>
</div>

<script>
  const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSA0efaKVbz-LL31DrKXrxbMo-4hKTb36ZzpjYXY7laLH5AmJGKiQp2FqvtQh8mj3TV6Mo995225hYr/pub?output=csv';

  // A sz≈±r≈ëk list√°ja, amit k√©rt√©l
  const MY_CATEGORIES = [
    'S√ºt√©s', 'F≈ëz√©s', 'S√ºt√©s √©s f≈ëz√©s n√©lk√ºl', 'Magyaros', '√Åzsiai', 'Mediterr√°n', 
    'K√∂ret', 'Sal√°ta', 'F≈ë√©tel', 'Reggeli/Vacsora', 'Leves', '√âdes desszert', 
    'S√≥s desszert', 'Ital', 'Egy√©b', 'Veget√°ri√°nus', 'Csirke', 'Halak √©s r√°kok', 
    'Marha/Sert√©s', 'Di√©t√°s', 'Gyors', 'Egyszer≈±'
  ];

  let allRecipes = [];
  let activeFilters = new Set(MY_CATEGORIES);

  // CSV feldolgoz√≥
  function parseCSV(csvText) {
    const rows = csvText.split(/\r?\n/).map(row => {
      return row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(cell => cell.replace(/^"|"$/g, '').trim());
    });
    const headers = rows[0].map(h => h.trim()); // Tiszt√≠tjuk a fejl√©ceket!
    return rows.slice(1).map(row => {
      let obj = {};
      headers.forEach((h, i) => { obj[h] = row[i] || ''; });
      return obj;
    }).filter(r => r['Recept neve'] || Object.values(r)[0]);
  }

  async function loadData() {
    try {
      const response = await fetch(SHEET_URL);
      const text = await response.text();
      allRecipes = parseCSV(text);
      
      document.getElementById('recipeCount').innerText = `${allRecipes.length} recept el√©rhet≈ë`;
      
      createFilterButtons();
      render();
    } catch (err) {
      document.getElementById('recipeCount').innerText = "Hiba az adatok bet√∂lt√©sekor!";
    }
  }

  function createFilterButtons() {
    const grid = document.getElementById('filterGrid');
    // Itt k√©nyszer√≠tj√ºk a gombok megjelen√≠t√©s√©t a MY_CATEGORIES alapj√°n
    grid.innerHTML = MY_CATEGORIES.map(cat => `
      <label class="filter-item active">
        <input type="checkbox" checked onchange="toggleFilter('${cat}', this)">
        ${cat}
      </label>
    `).join('');
  }

  function toggleFilter(cat, checkbox) {
    const label = checkbox.parentElement;
    if (checkbox.checked) {
      activeFilters.add(cat);
      label.classList.add('active');
    } else {
      activeFilters.delete(cat);
      label.classList.remove('active');
    }
    render();
  }

  function render() {
    const container = document.getElementById('recipesContainer');
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    
    const filtered = allRecipes.filter(r => {
      const name = (r['Recept neve'] || Object.values(r)[0] || '').toLowerCase();
      const ingredients = (r['Hozz√°val√≥k'] || '').toLowerCase();
      const matchesSearch = name.includes(searchTerm) || ingredients.includes(searchTerm);

      // Logika: Ha minden be van pip√°lva, mutassunk mindent. 
      // Ha sz≈±r√ºnk, akkor csak azt, amiben van 'x'.
      if (activeFilters.size === MY_CATEGORIES.length && !searchTerm) return true;

      // Megn√©zz√ºk, hogy a recept 'x'-elt oszlopai k√∂z√ºl legal√°bb egy benne van-e az akt√≠v sz≈±r≈ëkben
      const matchesCategory = MY_CATEGORIES.some(cat => 
        activeFilters.has(cat) && (r[cat] || '').toLowerCase() === 'x'
      );

      return matchesSearch && matchesCategory;
    });

    if (filtered.length === 0) {
      container.innerHTML = '<div class="no-results">Nincs tal√°lat a kiv√°lasztott sz≈±r≈ëkkel.</div>';
      return;
    }

    container.innerHTML = filtered.map(r => {
      const currentTags = MY_CATEGORIES.filter(cat => (r[cat] || '').toLowerCase() === 'x');
      return `
        <div class="recipe-card">
          <div class="recipe-img">ü•ò</div>
          <div class="recipe-body">
            <div class="recipe-title">${r['Recept neve'] || 'N√©vtelen recept'}</div>
            <div class="recipe-tags">
              ${currentTags.map(t => `<span class="recipe-tag">${t}</span>`).join('')}
            </div>
            <p style="font-size: 0.8em; color: #666;">${(r['Hozz√°val√≥k'] || '').substring(0, 60)}...</p>
            ${r['URL'] ? `<a href="${r['URL']}" target="_blank" class="recipe-link">Megnyit√°s ‚Üí</a>` : ''}
          </div>
        </div>
      `;
    }).join('');
  }

  document.getElementById('searchInput').addEventListener('input', render);
  loadData();
</script>

</body>
</html>
