<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>G√°bor szak√°csk√∂nyve 2026</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7f6; color: #333; padding: 20px; }
    .container { max-width: 1200px; margin: 0 auto; }
    header { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 40px 20px; border-radius: 15px; text-align: center; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    
    .controls { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 30px; }
    .search-box { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 20px; font-size: 16px; }
    
    .filter-grid { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
    .filter-item { background: #e9ecef; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 0.9em; user-select: none; transition: 0.2s; border: 1px solid #dee2e6; }
    .filter-item:hover { background: #dee2e6; }
    .filter-item.active { background: #2a5298; color: white; border-color: #2a5298; }
    .filter-item input { display: none; }

    .recipes { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
    .recipe-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: 0.3s; display: flex; flex-direction: column; }
    .recipe-card:hover { transform: translateY(-5px); }
    .recipe-img { width: 100%; height: 200px; background: #eee; display: flex; align-items: center; justify-content: center; font-size: 4em; }
    .recipe-body { padding: 20px; flex-grow: 1; }
    .recipe-title { font-size: 1.4em; font-weight: bold; margin-bottom: 10px; color: #1e3c72; }
    .recipe-tags { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 15px; }
    .recipe-tag { background: #f0f7ff; color: #0056b3; font-size: 0.75em; padding: 3px 8px; border-radius: 5px; border: 1px solid #cce5ff; }
    
    .recipe-link { display: inline-block; background: #2a5298; color: white; text-decoration: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; margin-top: auto; transition: 0.3s; }
    .recipe-link:hover { background: #1e3c72; }
    
    .no-results { grid-column: 1/-1; text-align: center; padding: 50px; font-size: 1.2em; color: #666; }
    #loader { text-align: center; padding: 20px; font-weight: bold; color: #1e3c72; }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>üç≥ G√°bor szak√°csk√∂nyve 2026</h1>
    <p>Saj√°t v√°logatott receptjeim</p>
  </header>

  <div class="controls">
    <input type="text" id="searchInput" class="search-box" placeholder="Keres√©s a receptek k√∂z√∂tt...">
    <div id="filterGrid" class="filter-grid">
      </div>
  </div>

  <div id="loader">Adatok szinkroniz√°l√°sa a Google T√°bl√°zatb√≥l...</div>
  <div id="recipesContainer" class="recipes"></div>
</div>

<script>
  const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSA0efaKVbz-LL31DrKXrxbMo-4hKTb36ZzpjYXY7laLH5AmJGKiQp2FqvtQh8mj3TV6Mo995225hYr/pub?output=csv';

  // Ezeket az oszlopokat keress√ºk mint kateg√≥ri√°kat (ahol 'x' lehet)
  const CATEGORY_COLUMNS = [
    'S√ºt√©s', 'F≈ëz√©s', 'S√ºt√©s √©s f≈ëz√©s n√©lk√ºl', 'Magyaros', '√Åzsiai', 'Mediterr√°n', 
    'K√∂ret', 'Sal√°ta', 'F≈ë√©tel', 'Reggeli/Vacsora', 'Leves', '√âdes desszert', 
    'S√≥s desszert', 'Ital', 'Egy√©b', 'Veget√°ri√°nus', 'Csirke', 'Halak √©s r√°kok', 
    'Marha/Sert√©s', 'Di√©t√°s', 'Gyors', 'Egyszer≈±'
  ];

  let allRecipes = [];
  let activeFilters = new Set(CATEGORY_COLUMNS); // Alap√©rtelmezetten minden be van kapcsolva

  function parseCSV(csvText) {
    const rows = csvText.split(/\r?\n/).map(row => {
      return row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(cell => cell.replace(/^"|"$/g, '').trim());
    });
    const headers = rows[0];
    return rows.slice(1).map(row => {
      let obj = {};
      headers.forEach((h, i) => { obj[h] = row[i] || ''; });
      return obj;
    }).filter(r => r['Recept neve'] || Object.values(r)[0]);
  }

  async function loadData() {
    try {
      const response = await fetch(SHEET_URL);
      const text = await response.text();
      allRecipes = parseCSV(text);
      document.getElementById('loader').style.display = 'none';
      
      createFilterButtons();
      render();
    } catch (err) {
      document.getElementById('loader').innerText = "Hiba t√∂rt√©nt az adatok bet√∂lt√©sekor.";
    }
  }

  function createFilterButtons() {
    const grid = document.getElementById('filterGrid');
    grid.innerHTML = CATEGORY_COLUMNS.map(cat => `
      <label class="filter-item active" data-cat="${cat}">
        <input type="checkbox" checked onchange="toggleFilter('${cat}', this)">
        ${cat}
      </label>
    `).join('');
  }

  function toggleFilter(cat, checkbox) {
    const label = checkbox.parentElement;
    if (checkbox.checked) {
      activeFilters.add(cat);
      label.classList.add('active');
    } else {
      activeFilters.delete(cat);
      label.classList.remove('active');
    }
    render();
  }

  function render() {
    const container = document.getElementById('recipesContainer');
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    
    const filtered = allRecipes.filter(r => {
      // Keres≈ë sz≈±r√©s
      const matchesSearch = !searchTerm || 
        (r['Recept neve'] || '').toLowerCase().includes(searchTerm) ||
        (r['Hozz√°val√≥k'] || '').toLowerCase().includes(searchTerm);

      // Kateg√≥ria sz≈±r√©s (Logika: Ha egy akt√≠v kateg√≥ri√°n√°l 'x' van, jelenjen meg)
      // Ha semmi nincs kiv√°lasztva, ne mutasson semmit, vagy ha minden ki van v√°lasztva, mutasson mindent.
      let matchesCategory = false;
      if (activeFilters.size === 0) {
        matchesCategory = false; 
      } else {
        // Megn√©zz√ºk, hogy a recept 'x'-elt oszlopai k√∂z√ºl legal√°bb egy benne van-e az akt√≠v sz≈±r≈ëkben
        matchesCategory = CATEGORY_COLUMNS.some(cat => 
          activeFilters.has(cat) && (r[cat] || '').toLowerCase() === 'x'
        );
      }

      // Speci√°lis eset: Ha a t√°bl√°zatban egyetlen kateg√≥ria sincs beikszelve a receptn√©l, 
      // de a keres≈ënek megfelel, akkor is mutassuk? Ink√°bb csak a kateg√≥ri√°kra hagyatkozzunk.
      
      return matchesSearch && matchesCategory;
    });

    if (filtered.length === 0) {
      container.innerHTML = '<div class="no-results">Nincs a v√°lasztott sz≈±r≈ëknek megfelel≈ë recept.</div>';
      return;
    }

    container.innerHTML = filtered.map(r => {
      const tags = CATEGORY_COLUMNS.filter(cat => (r[cat] || '').toLowerCase() === 'x');
      const img = r['K√©p'] ? `<img src="${r['K√©p']}" class="recipe-img" alt="recept">` : `<div class="recipe-img">ü•ò</div>`;

      return `
        <div class="recipe-card">
          ${img}
          <div class="recipe-body">
            <div class="recipe-title">${r['Recept neve'] || Object.values(r)[0]}</div>
            <div class="recipe-tags">
              ${tags.map(t => `<span class="recipe-tag">${t}</span>`).join('')}
            </div>
            <p style="font-size: 0.85em; color: #666; margin-bottom: 15px;">
              ${(r['Hozz√°val√≥k'] || '').substring(0, 80)}...
            </p>
            ${r['URL'] ? `<a href="${r['URL']}" target="_blank" class="recipe-link">Recept megnyit√°sa ‚Üí</a>` : ''}
          </div>
        </div>
      `;
    }).join('');
  }

  document.getElementById('searchInput').addEventListener('input', render);

  loadData();
</script>

</body>
</html>
